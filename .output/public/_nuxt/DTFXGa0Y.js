import{d as i,o as y,y as F,w as U,f as s,a as l,c as M,t as K,h as w,D as k,g as _,W as j,z as q,X as B,Z as A,I as Y,e as he,N as be,l as X,n as _e,i as xe,v as Ce,$ as Me,a0 as we}from"./CC3ln1j6.js";const Ie={class:"mt-2"},Ue={key:0,class:"mt-2 text-sm text-red-600"},Se={__name:"CreateCategory",props:{showModal:Boolean,closeModal:Function,onCategoryCreated:Function},setup(e){const o=e,r=i(""),a=i(!1),c=i(""),p=async()=>{if(r.value.trim()){a.value=!0;try{const d=await k(_("/supplier/misproductos/categories"),"POST",{name:r.value});d&&d.category?(typeof o.onCategoryCreated=="function"&&o.onCategoryCreated(d.category),o.closeModal()):(console.error("Error creating category:",d),c.value="Error creating category")}catch(d){console.error("Error creating category:",d),c.value="Error interno del servidor"}finally{a.value=!1}}};return(d,b)=>{const x=j,f=q,m=B,g=A;return y(),F(g,{showModal:e.showModal,closeModal:e.closeModal,title:"Crear Nueva Categoría"},{actions:U(()=>[s(m,{variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),s(m,{variant:"primary",isLoading:a.value,loadingText:"Creando...",defaultText:"Crear",onClick:p},null,8,["isLoading"])]),default:U(()=>[l("div",Ie,[s(x,{forId:"categoryName",text:"Nombre de la categoría:"}),s(f,{id:"categoryName",modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=h=>r.value=h),type:"text",placeholder:"Escribe el nombre de la categoría",required:""},null,8,["modelValue"]),c.value?(y(),M("p",Ue,K(c.value),1)):w("",!0)])]),_:1},8,["showModal","closeModal"])}}},ke={class:"mt-2"},Ee={key:0,class:"mt-2 text-sm text-red-600"},Ve={__name:"CreateSubcategory",props:{showModal:Boolean,closeModal:Function,categoryId:String,onSubcategoryCreated:Function},setup(e){const o=e,r=i(""),a=i(!1),c=i(""),p=async()=>{if(r.value.trim()){a.value=!0;try{const d=await k(_("/supplier/misproductos/subcategories"),"POST",{name:r.value,categoryId:o.categoryId});d&&d.subcategory?(typeof o.onSubcategoryCreated=="function"&&o.onSubcategoryCreated(d.subcategory),o.closeModal()):(console.error("Error creating subcategory:",d),c.value="Error creating subcategory")}catch(d){console.error("Error creating subcategory:",d),c.value="Error interno del servidor"}finally{a.value=!1}}};return(d,b)=>{const x=j,f=q,m=B,g=A;return y(),F(g,{showModal:e.showModal,closeModal:e.closeModal,title:"Crear Nueva Subcategoría"},{actions:U(()=>[s(m,{variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),s(m,{variant:"primary",isLoading:a.value,loadingText:"Creando...",defaultText:"Crear",onClick:p},null,8,["isLoading"])]),default:U(()=>[l("div",ke,[s(x,{forId:"subcategoryName",text:"Nombre de la subcategoría:"}),s(f,{id:"subcategoryName",modelValue:r.value,"onUpdate:modelValue":b[0]||(b[0]=h=>r.value=h),type:"text",placeholder:"Nombre de la subcategoría",required:""},null,8,["modelValue"]),c.value?(y(),M("p",Ee,K(c.value),1)):w("",!0)])]),_:1},8,["showModal","closeModal"])}}};var u=[];for(var $=0;$<256;++$)u.push(($+256).toString(16).slice(1));function Te(e,o=0){return(u[e[o+0]]+u[e[o+1]]+u[e[o+2]]+u[e[o+3]]+"-"+u[e[o+4]]+u[e[o+5]]+"-"+u[e[o+6]]+u[e[o+7]]+"-"+u[e[o+8]]+u[e[o+9]]+"-"+u[e[o+10]]+u[e[o+11]]+u[e[o+12]]+u[e[o+13]]+u[e[o+14]]+u[e[o+15]]).toLowerCase()}var D,De=new Uint8Array(16);function Ne(){if(!D&&(D=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!D))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return D(De)}var Oe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Z={randomUUID:Oe};function ee(e,o,r){if(Z.randomUUID&&!o&&!e)return Z.randomUUID();e=e||{};var a=e.random||(e.rng||Ne)();return a[6]=a[6]&15|64,a[8]=a[8]&63|128,Te(a)}const Le=async e=>{if(!e)throw new Error("Por favor seleccione un archivo.");const o=new FormData;o.append("myfile",e);const r=await fetch(_("/supplier/crear/uploadimage"),{method:"POST",body:o});if(!r.ok)throw new Error("Error al subir la imagen.");return(await r.json()).id},Pe=async(e,o,r)=>{const a=Y(),c={id:ee(),name:e.name,description:e.description,imageId:r,subcategoryId:o||e.subcategoryId,supplierId:a,status:"active",createdAt:new Date,updatedAt:new Date},p=await fetch(_("/supplier/crear/createproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!p.ok)throw new Error("Error al crear el producto.");return(await p.json()).id},$e=async(e,o,r,a)=>{const c=Y();if(!a)throw new Error("Unidad de medida es requerida.");const p={id:ee(),supplierId:c,productId:o,productName:r,price:e.price,unitOfMeasureId:a,status:"active",createdAt:new Date,updatedAt:new Date};if(!(await fetch(_("/supplier/crear/createsupplierproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)})).ok)throw new Error("Error al crear el producto.");return!0},Fe={class:"mt-2"},je={class:"mb-4"},qe={key:0,class:"flex flex-col items-center text-center"},Be=l("p",{class:"mt-2 text-sm font-semibold text-gray-600"},"Haz clic para subir o arrastra y suelta",-1),Ae=l("p",{class:"text-xs text-gray-500"},"SVG, PNG, JPG o GIF (Formato cuadrado recomendable)",-1),Ge=[Be,Ae],Re={key:1,class:"relative flex h-80 w-full items-center justify-center"},ze=["src"],He={key:0,class:"mt-2 flex justify-center gap-4"},Je={class:"mb-4 grid gap-4 sm:grid-cols-2"},We={class:"sm:col-span-2"},Qe=l("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva unidad de medida",-1),Xe=[Qe],Ze=l("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva categoría",-1),Ke=[Ze],Ye={key:0},eo=l("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),oo=[eo],to={key:1},ao=l("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),ro=[ao],no={class:"sm:col-span-2"},lo={__name:"CreateProduct",props:{showModal:Boolean,closeModal:Function,categoryId:String,subcategoryId:String},emits:["notify","productAdded"],setup(e,{emit:o}){const r=e,a=i({name:"",description:"",subcategoryId:r.subcategoryId||""}),c=i(null),p=i(null),d=i(""),b=i(!1),x=i(!1),f=i([]),m=i([]),g=i(r.categoryId||""),h=i(r.subcategoryId||""),S=i([]),I=i(null),oe=async()=>{try{const t=await k(_("/supplier/misproductos/getcategories"),"GET");f.value=t.data,!r.categoryId&&f.value.length>0&&(g.value=f.value[0].id,E(g.value))}catch(t){console.error("Error al obtener categorías",t)}},E=async t=>{try{const n=await k(_(`/supplier/misproductos/getsubcategoriesbycategory/${t}`),"GET");m.value=n.data,!r.subcategoryId&&m.value.length>0&&(h.value=m.value[0].id)}catch(n){console.error("Error al obtener subcategorías",n)}},te=async()=>{try{const t=await k(_("/supplier/misproductos/getunitofmeasures"),"GET");S.value=t.data,S.value.length>0&&(I.value=S.value[0].id)}catch(t){console.error("Error al obtener unidades de medida",t)}};he(()=>{oe(),te(),r.categoryId&&E(r.categoryId)}),be(g,t=>{t&&!r.categoryId&&E(t)});const ae=t=>{const n=t.target.files[0];n&&(c.value=n,p.value=URL.createObjectURL(n))},re=t=>{const n=t.dataTransfer.files[0];n&&(c.value=n,p.value=URL.createObjectURL(n))},ne=t=>{t.dataTransfer.dropEffect="copy"},G=()=>{document.querySelector('input[type="file"]').click()},se=()=>{G()},le=()=>{c.value=null,p.value=null},N=o,ce=async()=>{if(!(!a.value.name||!a.value.description||!I.value)){x.value=!0;try{const t=await Le(c.value),n=await Pe(a.value,h.value,t);await $e(T.value,n,a.value.name,I.value),d.value="Producto creado exitosamente!",b.value=!0,N("notify",{message:d.value,type:"success"}),N("productAdded"),r.closeModal(),a.value={name:"",description:"",subcategoryId:""},T.value={price:0},c.value=null,p.value=null}catch(t){d.value=t.message,b.value=!1,N("notify",{message:d.value,type:"error"})}finally{x.value=!1}}},O=i(!1),de=()=>{O.value=!0},ie=()=>{O.value=!1},ue=t=>{f.value.push(t),g.value=t.id,E(t.id),console.log("Nueva categoría creada:",t)},V=i(!1),R=()=>{V.value=!0},z=()=>{V.value=!1},H=t=>{m.value.push(t),h.value=t.id},T=i({price:""}),L=i(!1),pe=()=>{L.value=!0},ge=()=>{L.value=!1},me=t=>{S.value.push(t),I.value=t.id};return(t,n)=>{const C=j,J=q,P=Me,ve=we,ye=Se,W=Ve,Q=B,fe=A;return y(),F(fe,{showModal:e.showModal,closeModal:e.closeModal,title:"Agregar nuevo producto",size:"lg"},{actions:U(()=>[s(Q,{type:"button",variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),s(Q,{type:"button",variant:"primary",isLoading:x.value,loadingText:"Guardando...",defaultText:"Guardar",onClick:ce},null,8,["isLoading"])]),default:U(()=>[l("div",Fe,[l("div",je,[s(C,{forId:"",text:"Imagen del Producto:"}),l("div",{onDrop:X(re,["prevent"]),onDragover:X(ne,["prevent"]),onClick:G,class:_e({"flex h-40 cursor-pointer items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-200/20 p-6 hover:bg-gray-100":!c.value,"cursor-pointer rounded-md border-2 border-solid p-0":c.value})},[c.value?w("",!0):(y(),M("div",qe,Ge)),c.value?(y(),M("div",Re,[l("img",{src:p.value,alt:"Image Preview",class:"max-h-full max-w-full rounded-lg object-contain shadow-md"},null,8,ze)])):w("",!0)],34),c.value?(y(),M("div",He,[l("button",{onClick:le,type:"button",class:"rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-400"},"Quitar imagen"),l("button",{onClick:se,type:"button",class:"rounded-lg bg-gray-800 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400"},"Cambiar imagen")])):w("",!0),l("input",{type:"file",onChange:ae,class:"hidden",ref:"fileInput"},null,544)]),l("div",Je,[l("div",We,[s(C,{forId:"name",text:"Nombre del producto:"}),s(J,{id:"name",modelValue:a.value.name,"onUpdate:modelValue":n[0]||(n[0]=v=>a.value.name=v),type:"text",placeholder:"Escribe el nombre del producto",required:""},null,8,["modelValue"])]),l("div",null,[s(C,{forId:"price",text:"Precio:"}),s(J,{id:"price",modelValue:T.value.price,"onUpdate:modelValue":n[1]||(n[1]=v=>T.value.price=v),type:"text",placeholder:"Escribe el precio",oninput:"this.value = this.value.replace(/[^0-9]/g, '').replace(/(\\..*)\\./g, '$1');",required:""},null,8,["modelValue"])]),l("div",null,[s(C,{forId:"unitofmeasure-select",text:"Seleccione Unidad de Medida:"}),s(P,{id:"unitofmeasure-select",modelValue:I.value,"onUpdate:modelValue":n[2]||(n[2]=v=>I.value=v),options:S.value,required:""},null,8,["modelValue","options"]),l("div",{onClick:pe,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},Xe),s(ve,{showModal:L.value,closeModal:ge,onUnitOfMeasureCreated:me},null,8,["showModal"])]),l("div",null,[s(C,{forId:"category-select",text:"Seleccione Categoría:"}),s(P,{id:"category-select",modelValue:g.value,"onUpdate:modelValue":n[3]||(n[3]=v=>g.value=v),options:f.value,required:""},null,8,["modelValue","options"]),l("div",{onClick:de,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},Ke),s(ye,{showModal:O.value,closeModal:ie,onCategoryCreated:ue},null,8,["showModal"])]),g.value&&m.value.length>0?(y(),M("div",Ye,[s(C,{forId:"subcategory-select",text:"Seleccione Subcategoría:"}),s(P,{id:"subcategory-select",modelValue:h.value,"onUpdate:modelValue":n[4]||(n[4]=v=>h.value=v),options:m.value,required:""},null,8,["modelValue","options"]),l("div",{onClick:R,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},oo),s(W,{showModal:V.value,closeModal:z,categoryId:g.value,onSubcategoryCreated:H},null,8,["showModal","categoryId"])])):w("",!0),g.value&&m.value.length==0?(y(),M("div",to,[l("div",{onClick:R,class:"mt-2 flex h-full cursor-pointer items-center text-primary-600 hover:text-primary-800"},ro),s(W,{showModal:V.value,closeModal:z,categoryId:g.value,onSubcategoryCreated:H},null,8,["showModal","categoryId"])])):w("",!0),l("div",no,[s(C,{forId:"description",text:"Descripción:"}),xe(l("textarea",{"onUpdate:modelValue":n[5]||(n[5]=v=>a.value.description=v),id:"description",rows:"4",class:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500",placeholder:"Escribe la descripción del producto aquí"},null,512),[[Ce,a.value.description]])])])])]),_:1},8,["showModal","closeModal"])}}};export{lo as _};
