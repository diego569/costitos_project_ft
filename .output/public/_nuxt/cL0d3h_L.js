import{_ as pe}from"./CDrXyv1J.js";import{d as g,o as b,x as N,w as c,f as o,u as d,Y as T,j as I,a as t,G as z,V as F,b as G,i as L,v as q,S as A,E as O,g as _,H as Z,e as me,T as ge,l as W,n as ye,c as S,h as k,y as fe,U as ve}from"./DaUbdcHR.js";const be=t("div",{class:"fixed inset-0 bg-black/25"},null,-1),he={class:"fixed inset-0 overflow-y-auto"},xe={class:"flex min-h-full items-center justify-center p-4 text-center"},we=t("hr",{class:"mb-4"},null,-1),_e={class:"mt-2"},Ce={class:"mt-6 flex justify-end space-x-2"},Ie={__name:"CreateCategory",props:{showModal:Boolean,closeModal:Function,onCategoryCreated:Function},setup(e){const a=e,s=g(""),i=async()=>{if(s.value.trim())try{const n=await O(_("//supplier/misproductos/categories"),"POST",{name:s.value});n&&n.category?(typeof a.onCategoryCreated=="function"&&a.onCategoryCreated(n.category),a.closeModal()):console.error("Error creating category:",n)}catch(n){console.error("Error creating category:",n)}};return(n,m)=>(b(),N(d(A),{appear:"",show:e.showModal,as:"template"},{default:c(()=>[o(d(T),{as:"div",onClose:e.closeModal,class:"relative z-10"},{default:c(()=>[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[be]),_:1}),t("div",he,[t("div",xe,[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[o(d(z),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:c(()=>[o(d(F),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:c(()=>[G("Crear Nueva Categoría")]),_:1}),we,t("div",_e,[L(t("input",{"onUpdate:modelValue":m[0]||(m[0]=u=>s.value=u),type:"text",placeholder:"Nombre de la categoría",class:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-primary-500 focus:ring-primary-500"},null,512),[[q,s.value]])]),t("div",Ce,[t("button",{onClick:m[1]||(m[1]=(...u)=>e.closeModal&&e.closeModal(...u)),class:"rounded-md bg-gray-600 px-4 py-2 text-white hover:bg-gray-700"},"Cancelar"),t("button",{onClick:i,class:"rounded-md bg-primary-600 px-4 py-2 text-white hover:bg-primary-700"},"Crear")])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}},Me=t("div",{class:"fixed inset-0 bg-black/25"},null,-1),Se={class:"fixed inset-0 overflow-y-auto"},ke={class:"flex min-h-full items-center justify-center p-4 text-center"},Ue=t("hr",{class:"mb-4"},null,-1),Ve={class:"mt-2"},Ee={class:"mt-6 flex justify-end space-x-2"},Oe={__name:"CreateSubcategory",props:{showModal:Boolean,closeModal:Function,categoryId:String,onSubcategoryCreated:Function},setup(e){const a=e,s=g(""),i=g(!1),n=g(""),m=async()=>{if(s.value.trim()){i.value=!0;try{const u=await O(_("/supplier/misproductos/subcategories"),"POST",{name:s.value,categoryId:a.categoryId});u&&u.subcategory?(typeof a.onSubcategoryCreated=="function"&&a.onSubcategoryCreated(u.subcategory),a.closeModal()):(console.error("Error creating subcategory:",u),n.value="Error creating subcategory")}catch(u){console.error("Error creating subcategory:",u),n.value="Error interno del servidor"}finally{i.value=!1}}};return(u,h)=>(b(),N(d(A),{appear:"",show:e.showModal,as:"template"},{default:c(()=>[o(d(T),{as:"div",onClose:e.closeModal,class:"relative z-10"},{default:c(()=>[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[Me]),_:1}),t("div",Se,[t("div",ke,[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[o(d(z),{class:"w-full max-w-md transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:c(()=>[o(d(F),{as:"h3",class:"text-lg font-medium leading-6 text-gray-900"},{default:c(()=>[G("Crear Nueva Subcategoría")]),_:1}),Ue,t("div",Ve,[L(t("input",{"onUpdate:modelValue":h[0]||(h[0]=v=>s.value=v),type:"text",placeholder:"Nombre de la subcategoría",class:"w-full rounded-md border border-gray-300 px-4 py-2 focus:border-primary-500 focus:ring-primary-500"},null,512),[[q,s.value]])]),t("div",Ee,[t("button",{onClick:h[1]||(h[1]=(...v)=>e.closeModal&&e.closeModal(...v)),class:"rounded-md bg-gray-600 px-4 py-2 text-white hover:bg-gray-700"},"Cancelar"),t("button",{onClick:m,class:"rounded-md bg-primary-600 px-4 py-2 text-white hover:bg-primary-700"},"Crear")])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"]))}};var p=[];for(var $=0;$<256;++$)p.push(($+256).toString(16).slice(1));function je(e,a=0){return(p[e[a+0]]+p[e[a+1]]+p[e[a+2]]+p[e[a+3]]+"-"+p[e[a+4]]+p[e[a+5]]+"-"+p[e[a+6]]+p[e[a+7]]+"-"+p[e[a+8]]+p[e[a+9]]+"-"+p[e[a+10]]+p[e[a+11]]+p[e[a+12]]+p[e[a+13]]+p[e[a+14]]+p[e[a+15]]).toLowerCase()}var E,De=new Uint8Array(16);function Pe(){if(!E&&(E=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!E))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return E(De)}var $e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const X={randomUUID:$e};function ee(e,a,s){if(X.randomUUID&&!a&&!e)return X.randomUUID();e=e||{};var i=e.random||(e.rng||Pe)();return i[6]=i[6]&15|64,i[8]=i[8]&63|128,je(i)}const Ne=async e=>{if(!e)throw new Error("Por favor seleccione un archivo.");const a=new FormData;a.append("myfile",e);const s=await fetch(_("/supplier/crear/uploadimage"),{method:"POST",body:a});if(!s.ok)throw new Error("Error al subir la imagen.");return(await s.json()).id},Te=async(e,a,s)=>{const i=Z(),n={id:ee(),name:e.name,description:e.description,imageId:s,subcategoryId:a||e.subcategoryId,supplierId:i,status:"active",createdAt:new Date,updatedAt:new Date},m=await fetch(_("/supplier/crear/createproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!m.ok)throw new Error("Error al crear el producto.");return(await m.json()).id},ze=async(e,a,s)=>{const i=Z(),n={id:ee(),supplierId:i,productId:a,productName:s,price:e.price,unitOfMeasure:e.unitOfMeasure,status:"active",createdAt:new Date,updatedAt:new Date};if(!(await fetch(_("/supplier/crear/createsupplierproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)})).ok)throw new Error("Error al crear el producto.");return!0},Fe=t("div",{class:"fixed inset-0 bg-black/25"},null,-1),Ge={class:"fixed inset-0 overflow-y-auto"},Le={class:"flex min-h-full items-center justify-center p-4 text-center"},qe=t("hr",{class:"mb-4"},null,-1),Ae={class:"mt-2"},Re={class:"mb-4"},Be={class:"mb-4"},He={key:0,class:"flex flex-col items-center text-center"},Je=t("p",{class:"mt-2 text-sm font-semibold text-gray-600"},"Haz clic para subir o arrastra y suelta",-1),Ye=t("p",{class:"text-xs text-gray-500"},"SVG, PNG, JPG o GIF (Formato cuadrado recomendable)",-1),Ke=[Je,Ye],Qe={key:1,class:"relative flex h-80 w-full items-center justify-center"},We=["src"],Xe={key:0,class:"mt-2 flex justify-center gap-4"},Ze={class:"mb-4 grid gap-4 sm:grid-cols-2"},et={class:"sm:col-span-2"},tt=t("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva categoría",-1),at=[tt],ot={key:0},rt=t("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),st=[rt],lt={key:1},nt=t("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),it=[nt],ct={class:"sm:col-span-2"},dt={class:"mt-6 flex justify-end gap-2"},mt={__name:"CreateProduct",props:{showModal:Boolean,closeModal:Function,categoryId:String,subcategoryId:String},emits:["notify","productAdded"],setup(e,{emit:a}){const s=e,i=g({name:"",description:"",subcategoryId:s.subcategoryId||""}),n=g(null),m=g(null),u=g(""),h=g(!1),v=g([]),x=g([]),f=g(s.categoryId||""),M=g(s.subcategoryId||""),te=async()=>{try{const l=await O(_("/supplier/misproductos/getcategories"),"GET");v.value=l.data,!s.categoryId&&v.value.length>0&&(f.value=v.value[0].id,U(f.value))}catch(l){console.error("Error al obtener categorías",l)}},U=async l=>{try{const r=await O(_(`/supplier/misproductos/getsubcategoriesbycategory/${l}`),"GET");x.value=r.data,!s.subcategoryId&&x.value.length>0&&(M.value=x.value[0].id)}catch(r){console.error("Error al obtener subcategorías",r)}};me(()=>{te(),s.categoryId&&U(s.categoryId)}),ge(f,l=>{l&&!s.categoryId&&U(l)});const ae=l=>{const r=l.target.files[0];r&&(n.value=r,m.value=URL.createObjectURL(r))},oe=l=>{const r=l.dataTransfer.files[0];r&&(n.value=r,m.value=URL.createObjectURL(r))},re=l=>{l.dataTransfer.dropEffect="copy"},R=()=>{document.querySelector('input[type="file"]').click()},se=()=>{R()},le=()=>{n.value=null,m.value=null},j=a,ne=async()=>{try{const l=await Ne(n.value),r=await Te(i.value,M.value,l);await ze(C.value,r,i.value.name),u.value="Producto creado exitosamente!",h.value=!0,j("notify",{message:u.value,type:"success"}),j("productAdded"),s.closeModal(),i.value={name:"",description:"",subcategoryId:""},C.value={price:0,unitOfMeasure:""},n.value=null,m.value=null}catch(l){u.value=l.message,h.value=!1,j("notify",{message:u.value,type:"error"})}},D=g(!1),ie=()=>{D.value=!0},ce=()=>{D.value=!1},de=l=>{v.value.push(l),f.value=l.id,U(l.id),console.log("Nueva categoría creada:",l)},V=g(!1),B=()=>{V.value=!0},H=()=>{V.value=!1},J=l=>{x.value.push(l),M.value=l.id},Y=[{id:"kg",name:"kg (Kilogramos)"},{id:"g",name:"g (Gramos)"},{id:"lb",name:"lb (Libras)"},{id:"oz",name:"oz (Onzas)"},{id:"L",name:"L (Litros)"},{id:"ml",name:"ml (Mililitros)"},{id:"gal",name:"gal (Galones)"},{id:"fl oz",name:"fl oz (Onzas líquidas)"},{id:"m",name:"m (Metros)"},{id:"cm",name:"cm (Centímetros)"},{id:"mm",name:"mm (Milímetros)"},{id:"in",name:"in (Pulgadas)"},{id:"ft",name:"ft (Pies)"},{id:"u",name:"u (Unidad)"},{id:"pkg",name:"pkg (Paquete)"},{id:"doz",name:"doz (Docena)"}],C=g({price:"",unitOfMeasure:Y[0].id});return(l,r)=>{const w=pe,K=fe,P=ve,ue=Ie,Q=Oe;return b(),N(d(A),{appear:"",show:e.showModal,as:"template"},{default:c(()=>[o(d(T),{as:"div",onClose:e.closeModal,class:"relative z-10"},{default:c(()=>[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0","enter-to":"opacity-100",leave:"duration-200 ease-in","leave-from":"opacity-100","leave-to":"opacity-0"},{default:c(()=>[Fe]),_:1}),t("div",Ge,[t("div",Le,[o(d(I),{as:"template",enter:"duration-300 ease-out","enter-from":"opacity-0 scale-95","enter-to":"opacity-100 scale-100",leave:"duration-200 ease-in","leave-from":"opacity-100 scale-100","leave-to":"opacity-0 scale-95"},{default:c(()=>[o(d(z),{class:"w-full max-w-3xl transform overflow-hidden rounded-lg bg-white p-6 text-left align-middle shadow-xl transition-all"},{default:c(()=>[o(d(F),{as:"h3",class:"mb-4 text-lg font-medium leading-6 text-gray-900"},{default:c(()=>[G(" Agregar nuevo producto ")]),_:1}),qe,t("div",Ae,[t("div",Re,[t("div",Be,[o(w,{forId:"",text:"Imagen del Producto:"}),t("div",{onDrop:W(oe,["prevent"]),onDragover:W(re,["prevent"]),onClick:R,class:ye({"flex h-40 cursor-pointer items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-200/20 p-6 hover:bg-gray-100":!n.value,"cursor-pointer rounded-md border-2 border-solid p-0":n.value})},[n.value?k("",!0):(b(),S("div",He,Ke)),n.value?(b(),S("div",Qe,[t("img",{src:m.value,alt:"Image Preview",class:"max-h-full max-w-full rounded-lg object-contain shadow-md"},null,8,We)])):k("",!0)],34),n.value?(b(),S("div",Xe,[t("button",{onClick:le,type:"button",class:"rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-400"},"Quitar imagen"),t("button",{onClick:se,type:"button",class:"rounded-lg bg-gray-800 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400"},"Cambiar imagen")])):k("",!0),t("input",{type:"file",onChange:ae,class:"hidden",ref:"fileInput"},null,544)]),t("div",Ze,[t("div",et,[o(w,{forId:"name",text:"Nombre del producto:"}),o(K,{id:"name",modelValue:i.value.name,"onUpdate:modelValue":r[0]||(r[0]=y=>i.value.name=y),type:"text",placeholder:"Escribe el nombre del producto",required:""},null,8,["modelValue"])]),t("div",null,[o(w,{forId:"price",text:"Precio:"}),o(K,{id:"price",modelValue:C.value.price,"onUpdate:modelValue":r[1]||(r[1]=y=>C.value.price=y),type:"text",placeholder:"Escribe el precio",oninput:"this.value = this.value.replace(/[^0-9]/g, '').replace(/(\\..*)\\./g, '$1');",required:""},null,8,["modelValue"])]),t("div",null,[o(w,{forId:"unitOfMeasure",text:"Unidad de medida:"}),o(P,{id:"unitOfMeasure",modelValue:C.value.unitOfMeasure,"onUpdate:modelValue":r[2]||(r[2]=y=>C.value.unitOfMeasure=y),options:Y,required:""},null,8,["modelValue"])]),t("div",null,[o(w,{forId:"category-select",text:"Seleccione Categoría:"}),o(P,{id:"category-select",modelValue:f.value,"onUpdate:modelValue":r[3]||(r[3]=y=>f.value=y),options:v.value,required:""},null,8,["modelValue","options"]),t("div",{onClick:ie,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},at),o(ue,{showModal:D.value,closeModal:ce,onCategoryCreated:de},null,8,["showModal"])]),f.value&&x.value.length>0?(b(),S("div",ot,[o(w,{forId:"subcategory-select",text:"Seleccione Subcategoría:"}),o(P,{id:"subcategory-select",modelValue:M.value,"onUpdate:modelValue":r[4]||(r[4]=y=>M.value=y),options:x.value,required:""},null,8,["modelValue","options"]),t("div",{onClick:B,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},st),o(Q,{showModal:V.value,closeModal:H,categoryId:f.value,onSubcategoryCreated:J},null,8,["showModal","categoryId"])])):k("",!0),f.value&&x.value.length==0?(b(),S("div",lt,[t("div",{onClick:B,class:"mt-2 flex h-full cursor-pointer items-center text-primary-600 hover:text-primary-800"},it),o(Q,{showModal:V.value,closeModal:H,categoryId:f.value,onSubcategoryCreated:J},null,8,["showModal","categoryId"])])):k("",!0),t("div",ct,[o(w,{forId:"description",text:"Descripción:"}),L(t("textarea",{"onUpdate:modelValue":r[5]||(r[5]=y=>i.value.description=y),id:"description",rows:"4",class:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500",placeholder:"Escribe la descripción del producto aquí"},null,512),[[q,i.value.description]])])])])]),t("div",dt,[t("button",{type:"button",class:"inline-flex justify-center rounded-lg border border-gray-300 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2",onClick:r[6]||(r[6]=(...y)=>e.closeModal&&e.closeModal(...y))}," Cancelar "),t("button",{type:"button",class:"inline-flex justify-center rounded-lg border border-transparent bg-primary-600 px-4 py-2 text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 focus-visible:ring-offset-2",onClick:ne}," Guardar ")])]),_:1})]),_:1})])])]),_:1},8,["onClose"])]),_:1},8,["show"])}}};export{mt as _,Ie as a};
