import{d as c,o as b,y as q,w as x,f as t,a as r,c as w,t as K,h as U,D as V,g as M,W as B,z as j,X as A,Z as G,I as ce,e as Oe,N as Pe,l as le,n as se,u as X,F as $e,r as qe,i as Be,v as je,$ as Ae,a0 as Ge}from"./DHme-f7t.js";import{N as Re,Q as ze,V as He}from"./oDwxhNZS.js";const Je={class:"mt-2"},Qe={key:0,class:"mt-2 text-sm text-red-600"},We={__name:"CreateCategory",props:{showModal:Boolean,closeModal:Function,onCategoryCreated:Function},setup(e){const o=e,s=c(""),l=c(!1),d=c(""),i=async()=>{if(s.value.trim()){l.value=!0;try{const u=await V(M("/supplier/misproductos/categories"),"POST",{name:s.value});u&&u.category?(typeof o.onCategoryCreated=="function"&&o.onCategoryCreated(u.category),o.closeModal()):(console.error("Error creating category:",u),d.value="Error creating category")}catch(u){console.error("Error creating category:",u),d.value="Error interno del servidor"}finally{l.value=!1}}};return(u,v)=>{const y=B,_=j,g=A,p=G;return b(),q(p,{showModal:e.showModal,closeModal:e.closeModal,title:"Crear Nueva Categoría"},{actions:x(()=>[t(g,{variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),t(g,{variant:"primary",isLoading:l.value,loadingText:"Creando...",defaultText:"Crear",onClick:i},null,8,["isLoading"])]),default:x(()=>[r("div",Je,[t(y,{forId:"categoryName",text:"Nombre de la categoría:"}),t(_,{id:"categoryName",modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=C=>s.value=C),type:"text",placeholder:"Escribe el nombre de la categoría",required:""},null,8,["modelValue"]),d.value?(b(),w("p",Qe,K(d.value),1)):U("",!0)])]),_:1},8,["showModal","closeModal"])}}},Xe={class:"mt-2"},Ze={key:0,class:"mt-2 text-sm text-red-600"},Ke={__name:"CreateSubcategory",props:{showModal:Boolean,closeModal:Function,categoryId:String,onSubcategoryCreated:Function},setup(e){const o=e,s=c(""),l=c(!1),d=c(""),i=async()=>{if(s.value.trim()){l.value=!0;try{const u=await V(M("/supplier/misproductos/subcategories"),"POST",{name:s.value,categoryId:o.categoryId});u&&u.subcategory?(typeof o.onSubcategoryCreated=="function"&&o.onSubcategoryCreated(u.subcategory),o.closeModal()):(console.error("Error creating subcategory:",u),d.value="Error creating subcategory")}catch(u){console.error("Error creating subcategory:",u),d.value="Error interno del servidor"}finally{l.value=!1}}};return(u,v)=>{const y=B,_=j,g=A,p=G;return b(),q(p,{showModal:e.showModal,closeModal:e.closeModal,title:"Crear Nueva Subcategoría"},{actions:x(()=>[t(g,{variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),t(g,{variant:"primary",isLoading:l.value,loadingText:"Creando...",defaultText:"Crear",onClick:i},null,8,["isLoading"])]),default:x(()=>[r("div",Xe,[t(y,{forId:"subcategoryName",text:"Nombre de la subcategoría:"}),t(_,{id:"subcategoryName",modelValue:s.value,"onUpdate:modelValue":v[0]||(v[0]=C=>s.value=C),type:"text",placeholder:"Nombre de la subcategoría",required:""},null,8,["modelValue"]),d.value?(b(),w("p",Ze,K(d.value),1)):U("",!0)])]),_:1},8,["showModal","closeModal"])}}},Ye={class:"mt-2"},ea={key:0,class:"mt-2 text-sm text-red-600"},aa={__name:"CreateFeature",props:{showModal:Boolean,closeModal:Function,onFeatureCreated:Function},setup(e){const o=e,s=c(""),l=c(""),d=c(!1),i=c(""),u=async()=>{if(s.value.trim()){d.value=!0;try{const v=await V(M("/supplier/misproductos/features"),"POST",{name:s.value,description:l.value});v&&v.feature?(typeof o.onFeatureCreated=="function"&&o.onFeatureCreated(v.feature),o.closeModal()):(console.error("Error creando característica:",v),i.value="Error creando característica")}catch(v){console.error("Error creando característica:",v),i.value="Error interno del servidor"}finally{d.value=!1}}};return(v,y)=>{const _=B,g=j,p=A,C=G;return b(),q(C,{showModal:e.showModal,closeModal:e.closeModal,title:"Crear Nueva Característica"},{actions:x(()=>[t(p,{variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),t(p,{variant:"primary",isLoading:d.value,loadingText:"Creando...",defaultText:"Crear",onClick:u},null,8,["isLoading"])]),default:x(()=>[r("div",Ye,[t(_,{forId:"featureName",text:"Nombre de la característica:"}),t(g,{id:"featureName",modelValue:s.value,"onUpdate:modelValue":y[0]||(y[0]=I=>s.value=I),type:"text",placeholder:"Escribe el nombre de la característica",required:""},null,8,["modelValue"]),t(_,{forId:"featureDescription",text:"Descripción de la característica:"}),t(g,{id:"featureDescription",modelValue:l.value,"onUpdate:modelValue":y[1]||(y[1]=I=>l.value=I),type:"text",placeholder:"Escribe la descripción de la característica"},null,8,["modelValue"]),i.value?(b(),w("p",ea,K(i.value),1)):U("",!0)])]),_:1},8,["showModal","closeModal"])}}};var m=[];for(var Z=0;Z<256;++Z)m.push((Z+256).toString(16).slice(1));function ta(e,o=0){return(m[e[o+0]]+m[e[o+1]]+m[e[o+2]]+m[e[o+3]]+"-"+m[e[o+4]]+m[e[o+5]]+"-"+m[e[o+6]]+m[e[o+7]]+"-"+m[e[o+8]]+m[e[o+9]]+"-"+m[e[o+10]]+m[e[o+11]]+m[e[o+12]]+m[e[o+13]]+m[e[o+14]]+m[e[o+15]]).toLowerCase()}var $,oa=new Uint8Array(16);function ra(){if(!$&&($=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!$))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return $(oa)}var la=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const ne={randomUUID:la};function de(e,o,s){if(ne.randomUUID&&!o&&!e)return ne.randomUUID();e=e||{};var l=e.random||(e.rng||ra)();return l[6]=l[6]&15|64,l[8]=l[8]&63|128,ta(l)}const sa=async e=>{if(!e)throw new Error("Por favor seleccione un archivo.");const o=new FormData;o.append("myfile",e);const s=await fetch(M("/supplier/crear/uploadimage"),{method:"POST",body:o});if(!s.ok)throw new Error("Error al subir la imagen.");return(await s.json()).id},na=async(e,o,s)=>{const l=ce(),d={id:de(),name:e.name,description:e.description,imageId:s,subcategoryId:o||e.subcategoryId,supplierId:l,status:"active",createdAt:new Date,updatedAt:new Date},i=await fetch(M("/supplier/crear/createproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!i.ok)throw new Error("Error al crear el producto.");return(await i.json()).id},ca=async(e,o,s,l)=>{const d=ce();if(!l)throw new Error("Unidad de medida es requerida.");const i={id:de(),supplierId:d,productId:o,productName:s,price:e.price,unitOfMeasureId:l,status:"active",createdAt:new Date,updatedAt:new Date};if(!(await fetch(M("/supplier/crear/createsupplierproduct"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})).ok)throw new Error("Error al crear el producto.");return!0},da={class:"mt-2"},ua={class:"mb-4"},ia={key:0,class:"flex flex-col items-center text-center"},pa=r("p",{class:"mt-2 text-sm font-semibold text-gray-600"},"Haz clic para subir o arrastra y suelta",-1),ma=r("p",{class:"text-xs text-gray-500"},"SVG, PNG, JPG o GIF (Formato cuadrado recomendable)",-1),va=[pa,ma],ga={key:1,class:"relative flex h-80 w-full items-center justify-center"},fa=["src"],ya={key:0,class:"mt-2 flex justify-center gap-4"},ha={class:"mb-4 grid gap-4 sm:grid-cols-2"},ba={class:"sm:col-span-2"},_a=r("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva unidad de medida",-1),Ca=[_a],xa=r("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva categoría",-1),Ma=[xa],wa={key:0},Ia=r("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),Ua=[Ia],Va={key:1},Sa=r("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva subcategoría",-1),Ea=[Sa],ka={class:"mt-8 sm:col-span-2"},Fa={class:"flex-1"},Ta={class:"flex-1"},Na={class:"mt-2"},Da=r("p",{class:"select-none font-sans text-xs font-normal leading-normal antialiased"},"Crear nueva característica",-1),La=[Da],Oa={class:"sm:col-span-2"},qa={__name:"CreateProduct",props:{showModal:Boolean,closeModal:Function,categoryId:String,subcategoryId:String},emits:["notify","productAdded"],setup(e,{emit:o}){const s=e,l=c({name:"",description:"",subcategoryId:s.subcategoryId||""}),d=c(null),i=c(null),u=c(""),v=c(!1),y=c(!1),_=c([]),g=c([]),p=c(s.categoryId||""),C=c(s.subcategoryId||""),I=c([]),S=c(null),E=c([]),R=c(""),z=c(!1);c("");const k=c([{featureId:"",value:""}]),ue=c(""),ie=async()=>{try{const a=await V(M("/supplier/misproductos/getcategories"),"GET");_.value=a.data,!s.categoryId&&_.value.length>0&&(p.value=_.value[0].id,F(p.value))}catch(a){console.error("Error al obtener categorías",a)}},F=async a=>{try{const n=await V(M(`/supplier/misproductos/getsubcategoriesbycategory/${a}`),"GET");g.value=n.data,!s.subcategoryId&&g.value.length>0&&(C.value=g.value[0].id)}catch(n){console.error("Error al obtener subcategorías",n)}},pe=async()=>{try{const a=await V(M("/supplier/misproductos/getunitofmeasures"),"GET");I.value=a.data,I.value.length>0&&(S.value=I.value[0].id)}catch(a){console.error("Error al obtener unidades de medida",a)}},me=async()=>{try{const a=await V(M("/supplier/misproductos/getfeatures"),"GET");E.value=a.data,!R.value&&E.value.length>0&&(R.value=E.value[0].id)}catch(a){console.error("Error al obtener características",a)}},ve=()=>{k.value.push({featureId:"",value:""})},ge=a=>{k.value.splice(a,1)},fe=async a=>{try{y.value=!0;const n=k.value.filter(f=>f.featureId&&f.value);if(n.length===0)throw new Error("Debe seleccionar al menos una característica con valor.");for(const f of n)await V(M("/supplier/misproductos/addfeaturetoproduct"),"POST",{productId:a,featureId:f.featureId,value:f.value});console.log("Características asignadas con éxito")}catch(n){console.error("Error al asignar características al producto:",n),ue.value="Error al asignar características"}finally{y.value=!1}};Oe(()=>{ie(),pe(),me(),s.categoryId&&F(s.categoryId)}),Pe(p,a=>{a&&!s.categoryId&&F(a)});const ye=a=>{const n=a.target.files[0];n&&(d.value=n,i.value=URL.createObjectURL(n))},he=a=>{const n=a.dataTransfer.files[0];n&&(d.value=n,i.value=URL.createObjectURL(n))},be=a=>{a.dataTransfer.dropEffect="copy"},Y=()=>{document.querySelector('input[type="file"]').click()},_e=()=>{Y()},Ce=()=>{d.value=null,i.value=null},H=o,xe=async()=>{if(!(!l.value.name||!l.value.description||!S.value)){y.value=!0;try{const a=await sa(d.value),n=await na(l.value,C.value,a);await ca(N.value,n,l.value.name,S.value),fe(n),u.value="Producto creado exitosamente!",v.value=!0,H("notify",{message:u.value,type:"success"}),H("productAdded"),s.closeModal(),l.value={name:"",description:"",subcategoryId:""},N.value={price:0},d.value=null,i.value=null}catch(a){u.value=a.message,v.value=!1,H("notify",{message:u.value,type:"error"})}finally{y.value=!1}}},J=c(!1),Me=()=>{J.value=!0},we=()=>{J.value=!1},Ie=a=>{_.value.push(a),p.value=a.id,F(a.id),console.log("Nueva categoría creada:",a)},T=c(!1),ee=()=>{T.value=!0},ae=()=>{T.value=!1},te=a=>{g.value.push(a),C.value=a.id},N=c({price:""}),Q=c(!1),Ue=()=>{Q.value=!0},Ve=()=>{Q.value=!1},Se=a=>{I.value.push(a),S.value=a.id},Ee=()=>{z.value=!0},ke=()=>{z.value=!1},Fe=a=>{E.value.push(a),R.value=a.id};return(a,n)=>{const f=B,W=j,D=Ae,Te=Ge,Ne=We,oe=Ke,L=A,De=aa,Le=G;return b(),q(Le,{showModal:e.showModal,closeModal:e.closeModal,title:"Agregar nuevo producto",size:"lg"},{actions:x(()=>[t(L,{type:"button",variant:"secondary",defaultText:"Cancelar",onClick:e.closeModal},null,8,["onClick"]),t(L,{type:"button",variant:"primary",isLoading:y.value,loadingText:"Guardando...",defaultText:"Guardar",onClick:xe},null,8,["isLoading"])]),default:x(()=>[r("div",da,[r("div",ua,[t(f,{forId:"",text:"Imagen del Producto:"}),r("div",{onDrop:le(he,["prevent"]),onDragover:le(be,["prevent"]),onClick:Y,class:se({"flex h-40 cursor-pointer items-center justify-center rounded-md border-2 border-dashed border-gray-300 bg-gray-200/20 p-6 hover:bg-gray-100":!d.value,"cursor-pointer rounded-md border-2 border-solid p-0":d.value})},[d.value?U("",!0):(b(),w("div",ia,va)),d.value?(b(),w("div",ga,[r("img",{src:i.value,alt:"Image Preview",class:"max-h-full max-w-full rounded-lg object-contain shadow-md"},null,8,fa)])):U("",!0)],34),d.value?(b(),w("div",ya,[r("button",{onClick:Ce,type:"button",class:"rounded-lg bg-red-600 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-red-500 focus:outline-none focus:ring-2 focus:ring-red-400"},"Quitar imagen"),r("button",{onClick:_e,type:"button",class:"rounded-lg bg-gray-800 px-4 py-2 text-sm font-semibold text-white shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-400"},"Cambiar imagen")])):U("",!0),r("input",{type:"file",onChange:ye,class:"hidden",ref:"fileInput"},null,544)]),r("div",ha,[r("div",ba,[t(f,{forId:"name",text:"Nombre del producto:"}),t(W,{id:"name",modelValue:l.value.name,"onUpdate:modelValue":n[0]||(n[0]=h=>l.value.name=h),type:"text",placeholder:"Escribe el nombre del producto",required:""},null,8,["modelValue"])]),r("div",null,[t(f,{forId:"price",text:"Precio:"}),t(W,{id:"price",modelValue:N.value.price,"onUpdate:modelValue":n[1]||(n[1]=h=>N.value.price=h),type:"text",placeholder:"Escribe el precio",oninput:"this.value = this.value.replace(/[^0-9]/g, '').replace(/(\\..*)\\./g, '$1');",required:""},null,8,["modelValue"])]),r("div",null,[t(f,{forId:"unitofmeasure-select",text:"Seleccione Unidad de Medida:"}),t(D,{id:"unitofmeasure-select",modelValue:S.value,"onUpdate:modelValue":n[2]||(n[2]=h=>S.value=h),options:I.value,required:""},null,8,["modelValue","options"]),r("div",{onClick:Ue,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},Ca),t(Te,{showModal:Q.value,closeModal:Ve,onUnitOfMeasureCreated:Se},null,8,["showModal"])]),r("div",null,[t(f,{forId:"category-select",text:"Seleccione Categoría:"}),t(D,{id:"category-select",modelValue:p.value,"onUpdate:modelValue":n[3]||(n[3]=h=>p.value=h),options:_.value,required:""},null,8,["modelValue","options"]),r("div",{onClick:Me,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},Ma),t(Ne,{showModal:J.value,closeModal:we,onCategoryCreated:Ie},null,8,["showModal"])]),p.value&&g.value.length>0?(b(),w("div",wa,[t(f,{forId:"subcategory-select",text:"Seleccione Subcategoría:"}),t(D,{id:"subcategory-select",modelValue:C.value,"onUpdate:modelValue":n[4]||(n[4]=h=>C.value=h),options:g.value,required:""},null,8,["modelValue","options"]),r("div",{onClick:ee,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},Ua),t(oe,{showModal:T.value,closeModal:ae,categoryId:p.value,onSubcategoryCreated:te},null,8,["showModal","categoryId"])])):U("",!0),p.value&&g.value.length==0?(b(),w("div",Va,[r("div",{onClick:ee,class:"mt-2 flex h-full cursor-pointer items-center text-primary-600 hover:text-primary-800"},Ea),t(oe,{showModal:T.value,closeModal:ae,categoryId:p.value,onSubcategoryCreated:te},null,8,["showModal","categoryId"])])):U("",!0),r("div",ka,[t(X(Re),null,{default:x(({open:h})=>[t(X(ze),{class:"mb-4 cursor-pointer text-lg font-semibold"},{default:x(()=>[r("span",{class:se({"font-medium":h,"text-black":!h})},"➤ Características(agregar)",2)]),_:2},1024),t(X(He),null,{default:x(()=>[(b(!0),w($e,null,qe(k.value,(O,re)=>(b(),w("div",{key:re,class:"mb-4 flex items-center space-x-4"},[r("div",Fa,[t(f,{forId:"feature-select",text:"Seleccione Característica:"}),t(D,{id:"feature-select",modelValue:O.featureId,"onUpdate:modelValue":P=>O.featureId=P,options:E.value,optionLabel:"name",optionValue:"id",placeholder:"Selecciona una característica",required:""},null,8,["modelValue","onUpdate:modelValue","options"])]),r("div",Ta,[t(f,{forId:"feature-value",text:"Valor:"}),t(W,{id:"feature-value",modelValue:O.value,"onUpdate:modelValue":P=>O.value=P,type:"text",placeholder:"Escribe el valor",required:""},null,8,["modelValue","onUpdate:modelValue"])]),r("div",null,[t(L,{onClick:P=>ge(re),variant:"secondary",defaultText:"Eliminar"},null,8,["onClick"])])]))),128)),r("div",Na,[t(L,{onClick:ve,variant:"primary",defaultText:"Agregar más características"})]),r("div",{onClick:Ee,class:"mt-2 cursor-pointer text-primary-600 hover:text-primary-800"},La)]),_:1})]),_:1}),t(De,{showModal:z.value,closeModal:ke,onFeatureCreated:Fe},null,8,["showModal"])]),r("div",Oa,[t(f,{forId:"description",text:"Descripción:"}),Be(r("textarea",{"onUpdate:modelValue":n[5]||(n[5]=h=>l.value.description=h),id:"description",rows:"4",class:"block w-full rounded-lg border border-gray-300 bg-gray-50 p-2.5 text-sm text-gray-900 focus:border-primary-500 focus:ring-primary-500",placeholder:"Escribe la descripción del producto aquí"},null,512),[[je,l.value.description]])])])])]),_:1},8,["showModal","closeModal"])}}};export{qa as _};
